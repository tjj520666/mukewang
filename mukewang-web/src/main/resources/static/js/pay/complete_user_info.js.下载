define("common/js/complete_user_info",["require","moco","jqueryValidate"],function(){jQuery.validator.addMethod("phoneb",function(i,e){var t=/^(13[0-9]|14[56789]|15[012356789]|16[6]|17[12345678]|18[0-9]|19[89])[0-9]{8}$/g;return this.optional(e)||t.test(i)}),jQuery.validator.addMethod("email",function(i,e){var t=/^[a-zA-Z0-9]+([._\-][a-zA-Z0-9]+)*@([a-zA-Z0-9]+([._\-][a-zA-Z0-9]+))+$/;return this.optional(e)||t.test(i)}),jQuery.validator.addMethod("password",function(i,e){var t=/^[\w~`!@#$%&*()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return this.optional(e)||t.test(i)});var i,e=$("#improve-mode"),t="",s=0,r=0,o="";window.onload=function(){function a(){var i=$(".moco-modal-layer"),e=$(window).width(),t=$(window).height(),s=$(".moco-modal-layer").width(),r=$(".moco-modal-layer").height(),o=e/2-s/2,n=t/2-r/2;i.size()>0&&$(".moco-modal-layer").css({left:o,top:n})}if(e.size()>0){var d=$("#improve-mode").prop("outerHTML"),l=$.dialog(d,{title:"完善个人信息",modal:!0});l.boxy.find(".moco-icon-close").hide();var g=function(i){clearInterval(r),r=null,o=i.code,t=i.pubkey,s=i.servertime,setInterval(function(){s++},1e3)},u=$(".moco-modal-layer .improve").data("flag");switch(i=$(".moco-modal-layer .improve").validate({errorPlacement:function(i,e){$(e).closest(".box").find(".help-inline").html("").append($(i))}}),u){case 1:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}}),$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}}),$(".moco-modal-layer .js-password").rules("add",{required:!0,password:!0,messages:{required:"请输入登录密码",password:"密码格式不正确"}});break;case 2:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}});break;case 3:$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}})}}window.onresize=function(){a()},$(".moco-modal-layer").on("click",".getCode",function(){var i=$(this);if(i.hasClass("sending"))return!1;i.addClass("sending");var e,t=$(".moco-modal-layer .getCode"),s=60;e=setInterval(function(){if(0>=s)clearInterval(e),t.text("重新发送"),i.removeClass("sending");else{var r="获取验证码["+--s+"]";t.text(r)}},1e3);var r=$(".moco-modal-layer .js-phone").val();$.ajax({url:"/passport/user/checkphonecode",type:"post",data:{phone:r,noverify:1},dataType:"json",success:function(t){10001!=t.status&&(i.closest(".improve").find(".js-phone").siblings(".help-inline").html(t.msg),clearInterval(e),i.removeClass("sending"))}})}).on("click",".submitBtn",function(){var e=$(this),t=$(".moco-modal-layer .js-phone").val(),r=$(".moco-modal-layer .js-mobileverify").val(),a=$(".moco-modal-layer .js-email").val(),d=$(".moco-modal-layer .js-password").val();i.form()&&($(".moco-modal-layer .js-password").size()>0&&($.ajax({url:"/passport/user/prelogin",async:!1,type:"post",dataType:"json",success:function(i){10001==i.status&&g(i)}}),d=n(o+"	"+s+"	"+d),d=window.btoa(d)),$.ajax({url:"/passport/user/completeuserinfo",type:"post",data:{phone:t,mobileverify:r,email:a,password:d},dataType:"json",success:function(i){if(10001!=i.status&&11010!=i.status)for(var e in i.data)$(".js-"+e).closest(".box").find(".help-inline").html(i.data[e].msg);else 11010==i.status?window.location.href=window.location.href:($(".js-modal-close").click(),$.alert("恭喜你，完善个人信息成功"))},error:function(){e.closest(".box").find("help-inline").html("服务器无响应，稍后重试")}}))}).on("click",".js-pw",function(){$(this).hasClass("cur")?($(".moco-modal-layer .js-password").attr("type","password"),$(this).removeClass("cur")):($(".moco-modal-layer .js-password").attr("type","text"),$(this).addClass("cur"))}).on("click",".cancelBtn",function(){$(".js-modal-close").click()})};var n=function(i){function e(i){_=i,T=new Array(_);for(var e=0;e<T.length;e++)T[e]=0;Z=new s,Q=new s,Q.digits[0]=1}function s(i){this.digits="boolean"==typeof i&&1==i?null:T.slice(0),this.isNeg=!1}function r(i){var e=new s(!0);return e.digits=i.digits.slice(0),e.isNeg=i.isNeg,e}function o(i){var e=new s;e.isNeg=0>i,i=Math.abs(i);for(var t=0;i>0;)e.digits[t++]=i&D,i>>=B;return e}function n(i){var e,t=48,s=t+9,r=97,o=r+25,n=65,a=90;return e=i>=t&&s>=i?i-t:i>=n&&a>=i?10+i-n:i>=r&&o>=i?10+i-r:0}function a(i){for(var e=0,t=Math.min(i.length,4),s=0;t>s;++s)e<<=4,e|=n(i.charCodeAt(s));return e}function d(i){for(var e=new s,t=i.length,r=t,o=0;r>0;r-=4,++o)e.digits[o]=a(i.substr(Math.max(r-4,0),Math.min(r,4)));return e}function l(i){for(var e="",t=h(i);t>-1;--t)e+=g(i.digits[t]);return e}function g(i){var e=String.fromCharCode(255&i);i>>>=8;var t=String.fromCharCode(255&i);return t+e}function u(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=c(i,e),e.isNeg=!e.isNeg;else{t=new s;for(var r,o=0,n=0;n<i.digits.length;++n)r=i.digits[n]+e.digits[n]+o,t.digits[n]=65535&r,o=Number(r>=L);t.isNeg=i.isNeg}return t}function c(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=u(i,e),e.isNeg=!e.isNeg;else{t=new s;var r,o;o=0;for(var n=0;n<i.digits.length;++n)r=i.digits[n]-e.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=L),o=0-Number(0>r);if(-1==o){o=0;for(var n=0;n<i.digits.length;++n)r=0-t.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=L),o=0-Number(0>r);t.isNeg=!i.isNeg}else t.isNeg=i.isNeg}return t}function h(i){for(var e=i.digits.length-1;e>0&&0==i.digits[e];)--e;return e}function m(i){var e,t=h(i),s=i.digits[t],r=(t+1)*H;for(e=r;e>r-H&&0==(32768&s);--e)s<<=1;return e}function f(i,e){for(var t,r,o,n=new s,a=h(i),d=h(e),l=0;d>=l;++l){for(t=0,o=l,j=0;a>=j;++j,++o)r=n.digits[o]+i.digits[j]*e.digits[l]+t,n.digits[o]=r&D,t=r>>>B;n.digits[l+a+1]=t}return n.isNeg=i.isNeg!=e.isNeg,n}function v(i,e){var t,r,o;result=new s,t=h(i),r=0;for(var n=0;t>=n;++n)o=result.digits[n]+i.digits[n]*e+r,result.digits[n]=o&D,r=o>>>B;return result.digits[1+t]=r,result}function p(i,e,t,s,r){for(var o=Math.min(e+r,i.length),n=e,a=s;o>n;++n,++a)t[a]=i[n]}function w(i,e){var t=Math.floor(e/H),r=new s;p(i.digits,0,r.digits,t,r.digits.length-t);for(var o=e%H,n=H-o,a=r.digits.length-1,d=a-1;a>0;--a,--d)r.digits[a]=r.digits[a]<<o&D|(r.digits[d]&E[o])>>>n;return r.digits[0]=r.digits[a]<<o&D,r.isNeg=i.isNeg,r}function y(i,e){var t=Math.floor(e/H),r=new s;p(i.digits,t,r.digits,0,i.digits.length-t);for(var o=e%H,n=H-o,a=0,d=a+1;a<r.digits.length-1;++a,++d)r.digits[a]=r.digits[a]>>>o|(r.digits[d]&F[o])<<n;return r.digits[r.digits.length-1]>>>=o,r.isNeg=i.isNeg,r}function N(i,e){var t=new s;return p(i.digits,0,t.digits,e,t.digits.length-e),t}function $(i,e){var t=new s;return p(i.digits,e,t.digits,0,t.digits.length-e),t}function b(i,e){var t=new s;return p(i.digits,0,t.digits,0,e),t}function k(i,e){if(i.isNeg!=e.isNeg)return 1-2*Number(i.isNeg);for(var t=i.digits.length-1;t>=0;--t)if(i.digits[t]!=e.digits[t])return i.isNeg?1-2*Number(i.digits[t]>e.digits[t]):1-2*Number(i.digits[t]<e.digits[t]);return 0}function M(i,e){var t,o,n=m(i),a=m(e),d=e.isNeg;if(a>n)return i.isNeg?(t=r(Q),t.isNeg=!e.isNeg,i.isNeg=!1,e.isNeg=!1,o=c(e,i),i.isNeg=!0,e.isNeg=d):(t=new s,o=r(i)),new Array(t,o);t=new s,o=i;for(var l=Math.ceil(a/H)-1,g=0;e.digits[l]<P;)e=w(e,1),++g,++a,l=Math.ceil(a/H)-1;o=w(o,g),n+=g;for(var f=Math.ceil(n/H)-1,p=N(e,f-l);-1!=k(o,p);)++t.digits[f-l],o=c(o,p);for(var $=f;$>l;--$){var b=$>=o.digits.length?0:o.digits[$],j=$-1>=o.digits.length?0:o.digits[$-1],M=$-2>=o.digits.length?0:o.digits[$-2],z=l>=e.digits.length?0:e.digits[l],q=l-1>=e.digits.length?0:e.digits[l-1];t.digits[$-l-1]=b==z?D:Math.floor((b*L+j)/z);for(var C=t.digits[$-l-1]*(z*L+q),A=b*V+(j*L+M);C>A;)--t.digits[$-l-1],C=t.digits[$-l-1]*(z*L|q),A=b*L*L+(j*L+M);p=N(e,$-l-1),o=c(o,v(p,t.digits[$-l-1])),o.isNeg&&(o=u(o,p),--t.digits[$-l-1])}return o=y(o,g),t.isNeg=i.isNeg!=d,i.isNeg&&(t=d?u(t,Q):c(t,Q),e=y(e,g),o=c(e,o)),0==o.digits[0]&&0==h(o)&&(o.isNeg=!1),new Array(t,o)}function z(i,e){return M(i,e)[0]}function q(i){this.modulus=r(i),this.k=h(this.modulus)+1;var e=new s;e.digits[2*this.k]=1,this.mu=z(e,this.modulus),this.bkplus1=new s,this.bkplus1.digits[this.k+1]=1,this.modulo=C,this.multiplyMod=A,this.powMod=x}function C(i){var e=$(i,this.k-1),t=f(e,this.mu),s=$(t,this.k+1),r=b(i,this.k+1),o=f(s,this.modulus),n=b(o,this.k+1),a=c(r,n);a.isNeg&&(a=u(a,this.bkplus1));for(var d=k(a,this.modulus)>=0;d;)a=c(a,this.modulus),d=k(a,this.modulus)>=0;return a}function A(i,e){var t=f(i,e);return this.modulo(t)}function x(i,e){var t=new s;t.digits[0]=1;for(var r=i,o=e;;){if(0!=(1&o.digits[0])&&(t=this.multiplyMod(t,r)),o=y(o,1),0==o.digits[0]&&0==h(o))break;r=this.multiplyMod(r,r)}return t}function S(i){var e=1024;this.e=d("10001"),this.d=d(""),this.m=d(i),this.chunkSize="number"!=typeof e?2*h(this.m):e/8,this.radix=16,this.barrett=new q(this.m)}function I(i){var e,r,o,n,a,d,g,u,c=new Array,h=i.length,m="",f=new S(t);for(h>f.chunkSize-11&&(h=f.chunkSize-11),e=0,r=h-1;h>e;)c[r]=i.charCodeAt(e),e++,r--;for(r=f.chunkSize-h%f.chunkSize;r>0;){for(n=Math.floor(256*Math.random());!n;)n=Math.floor(256*Math.random());c[e]=n,e++,r--}for(c[h]=0,c[f.chunkSize-2]=2,c[f.chunkSize-1]=0,a=c.length,e=0;a>e;e+=f.chunkSize){for(d=new s,r=0,o=e;o<e+f.chunkSize;++r)d.digits[r]=c[o++],d.digits[r]+=c[o++]<<8;g=f.barrett.powMod(d,f.e),u=l(g),m+=u}return m}var _,T,Z,Q,B=16,H=B,L=65536,P=L>>>1,V=L*L,D=L-1;e(20);var E=(o(1e15),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535)),F=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);return e(131),I(i)}});