define(["/static/module/pay/center/js/util.js","/static/lib/jquery-qrcode/jquery.qrcode.min.js"],function(a){var e=function(a,e){var t,i=$(".total > .price > span").text(),o=$(".zg_hascoupon").val()>0?"有":"无";1==a?e&&(t=1==e?"花呗":"支付宝"):t=2==a?"微信":3==a?"京东":"余额",window.zg_upload_order={payway:t,price:i,hascoupon:o}};window._Util=a;var t=0,i=null,o=function(){5>t&&setTimeout(function(){t++,$.get("/pay/setwxpay",{trade_number:a.pay.number},function(a){"0"==a.result&&(t=5),o()},"json")},0)},n=function(){$(".js-recharge-btn").on("click",function(){a.balanceModalShow(2)});var t=$(".js-itemUl").children("li"),i=150*t.length,n=!1;$(".js-toggle-detai").on("click",function(){"收起"==$(this).html()?($(".js-itemUl").height(0),$(this).html("详情")):($(".js-itemUl").height(i),$(this).html("收起"))}),$(".js-itemUl li").length<3&&$(".js-toggle-detai").click(),$(".js-pay-method").on("click",".pay-way",function(){$(".js-pay-method").children("li").removeClass("active"),$(this).addClass("active"),$(this).hasClass("can-stage")?($(".summary").addClass("huabei-active"),$(".huabei-detail-box").show()):($(".summary").removeClass("huabei-active"),$(".huabei-detail-box").hide()),$(this).hasClass("jingdong")&&$(this).hasClass("can-jd-stage")?($(".summary").addClass("jdpay-stage-active"),$(".jdpay-detail-box").show()):($(".summary").removeClass("jdpay-stage-active"),$(".jdpay-detail-box").hide()),$(this).hasClass("yue")&&order_price>balance&&a.balanceModalShow(1,_pay,"余额支付")}),$(document).on("click",".js-pay-submit",function(){$(this);if(!$(this).hasClass("disabled")&&!n){n=!0;var t=$(".js-pay-method").children("li.active").attr("data-type");if(!t)return $.alert("请选择支付方式"),void(n=!1);var i=a.pay.number;if(1==t){var s=$(".js-pay-method").children("li.active").attr("data-account");if(1==s)var c=$(this).data("stage"),r="/pay/pay?trade_number="+i+"&pay_way=1&account=2&hb_fq_param="+c;else var r="/pay/pay?trade_number="+i+"&pay_way=1&account=2";e(t,s),a.alipayTarget(r),a.payStModalShow(),n=!1}else if(2==t)e(t),a.qrcodeShowModal(),l(),o(),n=!1;else if(3==t){var r="/pay/pay?trade_number="+i+"&pay_way=7";e(t),a.jdpayTarget(r),a.payStModalShow(),n=!1}else e(t),order_price>balance?(a.balanceModalShow(1,"","余额支付"),n=!1):(data={pay_way:5,trade_number:i},$.ajax({url:"/pay/pay",type:"get",dataType:"jsonp",jsonp:"jsonpcallback",data:data,success:function(a){0==a.result?window.location.href="/pay/myorder":($.prompt(a.msg||"操作失败，请稍后重试！",{icon:"error",shade:[.5,"#000"],time:2e3}),n=!1)},error:function(a){$.prompt(a.msg||"通信错误，请稍后重试！",{icon:"error",shade:[.5,"#000"],time:2e3}),n=!1}}))}})},s=function(){c(),l(),n()},c=function(){setTimeout(function(){a.loadqrcode(function(a){"0"!=a.result&&c()})},1e3)},l=function(){clearTimeout(i),i=null,$(".js-wechat-modal").length&&(i=setTimeout(function(){a.PaySuccess({trade_number:a.pay.number},function(a){"0"==a.result?location.href="/pay/myorder":l()})},1e3))},r=function(e){clearTimeout(i),i=null,$(".js-wechat-modal").length&&(i=setTimeout(function(){a.PayBalanceSuccess({trade_number:e},function(t){"0"==t.result?(a.balanceModal.hide(),a.balanceSuccModalShow(t.data)):r(e)})},1e3))};window.loadPayBalanceSuccess=r,window.loadQrcode=c,window.loadPaySuccess=l,s()});