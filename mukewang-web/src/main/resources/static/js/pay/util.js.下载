define(["moco"],function(){return{alipayTarget:function(a){var e=document.createElement("a");document.body.appendChild(e),e.href=a,e.target="_new",e.click(),document.body.removeChild(e)},jdpayTarget:function(a){var e=document.createElement("a");document.body.appendChild(e),e.href=a,e.target="_new",e.click(),document.body.removeChild(e)},payWxModal:null,qrcodeShowModal:function(a){var e=this.wechatModalTpl(a);this.payWxModal=$.dialog(e,{title:"",modal:!0,width:320}),$(".moco-modal-layer").removeClass("fixed"),this.qrcode.isGenerate=!0,this.qrcode.url&&(this.qrcode.generate(this.qrcode.url),this.qrcode.isGenerate=!1),this.payWxEvent()},payWxEvent:function(){var a=this;$(".wechat-modal").on("click",".js-restart-btn",function(){a.payWxModal.hide()})},wechatModalTpl:function(a){var e;return e=a?a:$("#jsPrice").val(),["<div class='wechat-modal js-wechat-modal'>","<div class='modal'>","<h1 class='price'>微信支付￥<span>"+e+"</span></h1>","<div class='qrcode js-qrcode-img'>","<img src='/static/module/common/img/loading.gif' class='js-loading'/>","</div>","<p>使用微信扫描二维码进行支付</p>","<div class='restart-btn js-restart-btn'><span class='imv2-refresh'></span>重新选择支付方式</div>","</div>","</div>"].join("")},qrcode:{url:!1,msg:"",isGenerate:!1,generate:function(a){var e=$(".js-wechat-modal");e.find(".js-loading").remove(),e.find(".js-qrcode-img").qrcode({width:180,height:180,text:a})}},pay:{number:$(".js-pay-submit").attr("data-ordernum")},loadqrcode:function(a){var e=this,s={};s.trade_number=e.pay.number,s.pay_way=2,$.ajax({url:"/pay/pay",dataType:"jsonp",data:s,jsonp:"jsonpcallback",success:function(s){if(e.qrcode.msg=s.msg,"0"==s.result){var c=s.data.code_url;e.qrcode.url=c,e.qrcode.isGenerate&&e.qrcode.generate(c)}a&&a(s)}})},payModal:null,payStModalShow:function(a,e){var s=this.payStModalTpl(),c={title:"",modal:!0};this.payModal=$.dialog(s,c),$(".moco-modal-layer").removeClass("fixed"),this.payStEvent(a,e)},payStModalTpl:function(){return["<div class='pay-tip-modal'>","<div class='modal'>","<div class='wait-img'><span class='imv2-load_o'></span></div>","<h3>等待您完成支付...</h3>","<p class='js-error'>请在支付页面继续完成支付</p>","<div class='clearfix btnwarp'>","<div class='success-btn js-success-btn' data-isPay='1' >支付完成</div>","<div class='restart-btn js-restart-btn'><span class='imv2-refresh'></span>重新选择支付方式</div>","</div>","</div>","</div>"].join("")},payStEvent:function(a,e){var s=this;$(".pay-tip-modal").on("click",".js-restart-btn",function(){s.payModal.hide()});var c=!1;$(".pay-tip-modal").on("click",".js-success-btn",function(){c||(c=!0,"balance"==a?(data={trade_number:e},s.PayBalanceSuccess(data,function(a){c=!1,"0"==a.result?(s.balanceModal.hide(),s.balanceSuccModalShow(a.data)):($(".js-error").html("未支付成功，请在支付页面继续完成支付！"),$(".js-error").addClass("error"))})):(data={trade_number:s.pay.number},s.PaySuccess(data,function(a){c=!1,"0"==a.result?location.href="/pay/myorder":($(".js-error").html("未支付成功，请在支付页面继续完成支付！"),$(".js-error").addClass("error"))})))})},PaySuccess:function(a,e){$.ajax({url:"/pay/payresult",dataType:"jsonp",data:a,jsonp:"jsonpcallback",success:function(a){e&&e(a)}})},PayBalanceSuccess:function(a,e){$.ajax({url:"/pay/paybalanceresult",dataType:"jsonp",data:a,jsonp:"jsonpcallback",success:function(a){e&&e(a)}})},balanceModal:null,balanceModalShow:function(a,e){var s="";if("1"==a){var c=this.balanceModalNewTpl(e);s="余额支付"}else{var c=this.balanceModalTpl();title="余额充值"}var i={title:s,modal:!0,callback:function(){var a=window.location.pathname;"/pay/cashier"==a&&$(".alipay").click()}};this.balanceModal=$.dialog(c,i),$(".moco-modal-layer").removeClass("fixed"),this.balanceEvent()},balanceModalNewTpl:function(a){return["<div class='pay-balance-modal'>","<div class='modal'>","<p>剩余需支付金额</p>","<ul class='rechargeMoney js-recharge-money'>","<li class='active' data-money="+a+">","<h2>￥"+a+"</h2>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","</ul>","<p>支付方式</p>","<ul class='rechargeType js-recharge-type'>","<li class='active alipay' data-type='1'>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","<li class='wxpay' data-type='2'>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","</ul>","<button class='js-rechare-balance' data-type='1'>立即支付</button>","<p class='tip'>点击立即支付则视为您已同意<a href='//www.imooc.com/help/detail/89' target='_new'>《慕课网用户协议》</a></p>","</div>","</div>"].join("")},balanceModalTpl:function(){return["<div class='pay-balance-modal'>","<div class='modal'>","<p>充值金额<span>不可用于ios客户端</span></p>","<ul class='rechargeMoney js-recharge-money'>","<li class='active' data-money='1'>","<h2>￥300</h2>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","<li data-money='2'>","<h2>￥500</h2>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","<li data-money='3'>","<h2>￥1000</h2>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li><br>","<li data-money='4' class='js-custom-recharge custom-recharge'>","<span class='money-icon'>￥</span>","<input type='text' maxlength='5' placeholder='其他金额，请输入1-50000的整数' class='js-custom-input' autocomplete='off' onKeyUp=\"value=value.replace(/[^0-9]/g,'');value=value.replace(/^0/g,'')\" />","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","</ul>","<p>支付方式</p>","<ul class='rechargeType js-recharge-type'>","<li class='active alipay' data-type='1'>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","<li class='wxpay' data-type='2'>","<div class='bottomright'>","<div class='triangle'></div>","<i class='imv2-check'></i>","</div>","</li>","</ul>","<button class='js-rechare-balance'>立即充值</button>","<p class='tip'>点击立即充值则视为您已同意<a href='//www.imooc.com/help/detail/89' target='_new'>《慕课网用户协议》</a></p>","</div>","</div>"].join("")},balanceEvent:function(){var a,e,s,c=this,i=!1,t=/^\d+$/;$(this).hasClass("disabled")||($(".pay-balance-modal").on("click",".js-recharge-money li",function(){4!=$(this).data("money")?($(this).addClass("active").siblings().removeClass("active"),$(".js-custom-input").val("")):$(".js-custom-input").focus()}),$(".js-custom-input").on("keyup",function(){var a=$(this).val();a.match(t)&&a>0&&5e4>=a?$(this).parent().addClass("active").siblings().removeClass("active"):($(this).parents(".rechargeMoney").find("li").removeClass("active").first().addClass("active"),$(this).val(""))}),$(".pay-balance-modal").on("click",".js-recharge-type li",function(){$(this).addClass("active").siblings().removeClass("active")}),$(".pay-balance-modal").on("click",".js-rechare-balance",function(){if(!i){i=!0;var t=$(this);if("1"==t.data("type"))e=$(".js-recharge-money").children("li.active").attr("data-money");else{var l=$(".js-recharge-money").children("li.active").attr("data-money");if(!l)return $.alert("请选择充值金额"),void(i=!1);1==l?e=300:2==l?e=500:3==l?e=1e3:4==l&&(e=parseInt($(".js-custom-input").val()))}var n=$(".js-recharge-type").children("li.active").attr("data-type"),o=$(".trade-title").find(".num").text();if(!n)return $.alert("请选择充值方式"),void(i=!1);s="1"==t.data("type")?a?{pay_way:n,money:e,is_ajax:1,trade_number:a,number:o}:{pay_way:n,money:e,is_ajax:1,number:o}:a?{pay_way:n,money:e,is_ajax:1,trade_number:a}:{pay_way:n,money:e,is_ajax:1},$.ajax({url:"/pay/paybalance",type:"get",dataType:"jsonp",data:s,jsonp:"jsonpcallback",async:!1,success:function(s){if(0==s.result){if(a=s.data.trade_number,1==n){var l="/pay/paybalance?trade_number="+a+"&pay_way=1&money="+e+"&number="+o;c.alipayTarget(l),"1"==t.data("type")?c.payStModalShow("",a):c.payStModalShow("balance",a),i=!1}else if(2==n){var l=s.data.code_url;c.qrcode.url=l,c.qrcodeShowModal(e),loadPayBalanceSuccess(a),i=!1}}else $.prompt(s.msg||"通信错误，请稍后重试！",{icon:"error",shade:[.5,"#000"],time:2e3}),i=!1},error:function(a){$.prompt(a.msg||"通信错误，请稍后重试！",{icon:"error",shade:[.5,"#000"],time:2e3}),i=!1}})}}))},balanceSuccModal:null,balanceSuccModalShow:function(a){var e=this.balanceSuccModalTpl(a),s={title:"",width:394,modal:!0,callback:function(){window.location.reload()}};this.balanceSuccModal=$.dialog(e,s),$(".moco-modal-layer").removeClass("fixed"),this.balanceSuccEvent()},balanceSuccModalTpl:function(a){return["<div class='balance-success-modal'>","<div class='modal'>","<div class='succ-img'><span class='imv2-check'></span></div>","<h3>充值成功</h3>","<p class='js-error'>您充值的 ￥<span>"+a+"</span> 余额已到账</p>","<div class='clearfix btnwarp'>","<button class='success-btn js-success-btn'>支付完成</button>","</div>","</div>","</div>"].join("")},balanceSuccEvent:function(){$(".balance-success-modal").on("click",".js-success-btn",function(){window.location.reload()})}}});