define(function(require){function a(a){a?$('<img id="loadimg" style="position:absolute;top:50%;margin-left:380px;z-index:9999;" src="/static/img/course/loading.gif" alt="加载中..." />').appendTo(".wiki-item"):$("#loadimg").remove()}require("common");var c=require("./search"),h=null;$("#main").on("input",".js-search-ipt",function(){var a=this.value;if(""==a)return c.setSearchHistory(),!1;var k=$(".js-search-history");return k.hide(),h=setTimeout(function(){c.associative(a)},500),!1});var k=function(){var a=$("#main").find(".js-search-ipt").val();return""==a?void $.alert("请输入想搜索的内容"):void c.location(OP_CONFIG.$pager,a)},v=function(c){a(!0);var h="",k=$("#main").find(".js-search-ipt").val();$.ajax({url:"//wiki.imooc.com/api/imoocsearch",data:"keyword="+k+"&page="+c,type:"post",dataType:"json",success:function(c){if(a(!1),c.data.total||(c.data.total=0),$(".js-wiki-num em").html(c.data.total),"index"==OP_CONFIG.$pager){var k=parseInt(_num+c.data.total);$(".js-all-count em").html(k)}if(c.data.list&&c.data.list.length>0){var v=c.data.list;$(".js-page_num").val(c.data.page),$.each(v,function(a,c){h+='<div class="wiki-list"><a href="'+c.jump_url+'" target="_blank" class="title">'+c.name+"</a><p>"+c.content+"</p></div>"}),$(".wiki-item").append(h),v.length<10?$(".js-more-wiki").hide():$(".js-more-wiki").show()}else $(".js-more-wiki").hide();c.data.total>10?$(".js-all-more-wiki").show():$(".js-all-more-wiki").hide()}})};$(document).on("click",".js-more-wiki",function(){var a=$(".js-page_num").val(),c=parseInt(a)+1;v(c)});var w=function(){var a=$(".js-search-history"),v=$(".search-default-order"),w=$(".search-related-classify"),g=$(".search-related-wendaclassify");$(document).on("click",function(){w.css({background:"","box-shadow":""}),v.css({background:"","box-shadow":""}),g.css({background:"","box-shadow":""}),a.hide(),v.removeClass("cur"),w.removeClass("cur"),g.removeClass("cur")}),a.on("click",".li > a",function(){c.location(OP_CONFIG.$pager,$(this).text())}),$("#main").on("focus",".js-search-ipt",function(a){var h=this.value;return""==h&&c.setSearchHistory(),a.preventDefault(),!1}).on("keyup",".js-search-ipt",function(e){this.value;13==e.keyCode&&"undefined"==typeof $(".js-moco-modal-cancel").html()&&k(),c.keyup(e.keyCode)}).on("keydown",".js-search-ipt",function(){clearTimeout(h)}).on("click",".js-search-ipt",function(a){return a.preventDefault(),!1}),$("#main").on("click",".js-search-btn",function(){k()}),$(".search-classify").on("click","a",function(a){var h=$(this).attr("data-page");return value=$("#main").find(".js-search-ipt").val(),c.location(h,value),OP_CONFIG.$pager,value,a.preventDefault(),!1}),w.on("mouseover",function(a){w.addClass("cur"),a.stopPropagation();var c=$("#main").find(".js-search-ipt").val(),h=$(".js-order-list>span").attr("class"),k=$(".js-course-content>p");k.each(function(a){$(this).on("click",function(){location.href=h?"/search/course?words="+encodeURIComponent(c)+k.eq(a).attr("class")+h:"/search/course?words="+encodeURIComponent(c)+k.eq(a).attr("class")})})}),v.on("click",function(a){v.addClass("cur"),a.stopPropagation();var c=$("#main").find(".js-search-ipt").val(),h=$(".js-course-list>span").attr("class"),k=$(".js-order-content>p");k.each(function(a){$(this).on("click",function(){location.href="/search/course?words="+encodeURIComponent(c)+"&type="+h+k.eq(a).attr("class")})})}),g.on("mouseover",function(a){g.addClass("cur"),a.stopPropagation();var c=$("#main").find(".js-search-ipt").val();$(".js-wenda-content>p").each(function(a){$(this).on("click",function(){location.href="/search/wenda?words="+encodeURIComponent(c)+$(".js-wenda-content>p").eq(a).attr("class")})})}),$(".wenda-detail-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid})}),$(".article-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid})}),$(".course-detail-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid})});var j={index:"全站",course:"课程",article:"手记",wenda:"猿问",wiki:"wiki"};$("#main").on("click",".course-detail-title, .course-detail-title img",function(){zhuge.track("SearchResult",{KeyWord:OP_CONFIG.$words,Source:j[OP_CONFIG.page]})}).on("click",".wenda-detail-title a",function(){var a=$(this);return zhuge.track("SearchResult",{KeyWord:OP_CONFIG.$words,Source:j[OP_CONFIG.page]},function(){location.href=a.attr("href")}),!1}).on("click",".article-item .article-title, .article-item .article-arrow",function(){zhuge.track("SearchResult",{KeyWord:OP_CONFIG.$words,Source:j[OP_CONFIG.page]})}).on("click",".wiki-list a.title",function(){var a=$(this);return zhuge.track("SearchResult",{KeyWord:OP_CONFIG.$words,Source:j[OP_CONFIG.page]},function(){location.href=a.attr("href")}),!1})};w(),v(0)});