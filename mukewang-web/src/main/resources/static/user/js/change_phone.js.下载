define(function(require,exports,module){require("/static/lib/backbone/backbone-1.0.0.min.js");var c=require("./tpl.js"),a=Backbone.View.extend({initialize:function(){this.tpl=c;var a=this;this.timer="",$(document).on("blur",".js-phoneNumber1",function(){a.blurToCheckPhone($(this).val())})},events:{"click .tpl-changePhone .js-getCode":"getMessageCode","click .tpl-changePhone .js-voicecode-send":"getVoiceCode","click .tpl-changePhone .js-submit":"clickToSubmit","click  .js-code-tab":"clickAreaCode","click  .js-code-btn":"showAreaCode","click  [data-code]":"setAreaCode"},math:function(){var c="sohu.com::http://mail.sohu.com                         |sina.com,sina.cn :: http://mail.sina.com                         |vip.sina.com :: http://vip.sina.com.cn                         |126.com :: http://www.126.com                         |163.com :: http://mail.163.com                         |vip.163.com :: http://vip.163.com                         |vip.126.com :: http://vip.126.com                         |qq.com,vip.qq.com :: http://mail.qq.com                         |msn.com,outlook.com,hotmail.com,live.cn,live.com :: http://outlook.com                         |gmail.com :: http://www.gmail.com                         |yahoo.com.cn,yahoo.cn,aliyun.com :: http://mail.aliyun.com                         |yahoo.com.tw :: http://mail.yahoo.com.tw                         |21cn.com :: http://mail.21cn.com                         |tom.com :: http://mail.tom.com/ ",a={};$.each(c.split("|"),function(c,h){var i,g,v=h.split("::"),h=$.trim(v[1]);for(v=v[0].split(","),i=0,g=v.length;g>i;i++)a[$.trim(v[i])]=h});var h=a[this.mall.match(/[^@]*$/)[0]];this.$el.find("#js-gotoVerity").attr("href",h)},resendCode:function(){clearInterval(this.timer);var c=60,a=this.$el.find(".js-timer"),h=this;this.timer=setInterval(function(){1>c?(clearInterval(h.timer),"+86"!=$(".js-code-btn").text()?a.addClass("js-getCode active").html("短信接收").css({right:"18px"}):(a.addClass("js-getCode active").html("短信接收").css({right:"112px"}),a.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'))):(a.removeClass("active").css({right:"18px"}).html(c+" s 后重新获取"),$(".js-voicecode-send").remove()),c--},1e3)},getMessageCode:function(){this.clickTogetCode(0)},getVoiceCode:function(){this.clickTogetCode(1)},clickTogetCode:function(c){$(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("");var a=this.$el.find(".js-phoneNumber1").val(),h=a,r=W.Validater.validateRules["require-mobile-phone"].regex;if(r.lastIndex=0,0==h.length)return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入手机号").addClass("tips-error");if("+86"==$(".js-code-btn").text()&&!r.test(h))return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入正确手机号").addClass("tips-error");var g=$(".js-code-btn").text();"+86"!=g&&(a=g+a);var v=this,j={phone:a,noverify:1};1==c&&(j.typecode=1),$.ajax({url:"/passport/user/getphonelogincode",dataType:"json",data:j,success:function(c){10001==c.status?($(".js-timer").removeClass("js-getCode").css("cursor","default"),v.resendCode()):v.$el.find(".js-gerror").html(c.msg)},error:function(){$(".tpl-changePhone .js-submit").text("保存"),v.$el.find(".js-gerror").html("系统出错，请稍后重试！")},complete:function(){}})},blurToCheckPhone:function(c){$(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("");var a=c,r=W.Validater.validateRules["require-mobile-phone"].regex;if(r.lastIndex=0,0==a.length)return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入手机号").addClass("tips-error");if("+86"==$(".js-code-btn").text()&&!r.test(a))return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入正确手机号").addClass("tips-error");var h=c,g=$(".js-code-btn").text();"+86"!=g&&(h=g+h),moco.validateCallback.rel=!1,$.ajax({url:"/passport/user/checkphone",type:"post",data:{phone:h},dataType:"json",success:function(c){10001==c.status?moco.validateCallback.rel=!0:(moco.validateCallback.errorHint=c.msg,".js-phoneNumber1".parents(".moco-form-group").find(".moco-control-tip").html(c.msg))},error:function(){moco.validateCallback.errorHint="网络错误"}})},clickToSubmit:function(){var c=this,a=this.$el.find(".js-phoneNumber1").val(),h=this.$el.find(".js-phoneCode").val(),g=a,r=W.Validater.validateRules["require-mobile-phone"].regex;if(r.lastIndex=0,0==g.length)return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入手机号").addClass("tips-error");if("+86"==$(".js-code-btn").text()&&!r.test(g))return void $(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html("请输入正确手机号").addClass("tips-error");if(!h.length)return void $(".js-phoneCode").closest(".moco-form-group").find(".moco-control-tip").html("请输入短信验证码").addClass("tips-error");if(4!=h.length)return void $(".js-phoneCode").closest(".moco-form-group").find(".moco-control-tip").html("请输入正确短信验证码").addClass("tips-error");$(".js-phoneCode").closest(".moco-form-group").find(".moco-control-tip").html("").removeClass("tips-error");var v=$(".js-code-btn").text();"+86"!=v&&(a=v+a),$(".tpl-changePhone .js-submit").text("正在保存..."),$.ajax({url:"/passport/user/bindphone",dataType:"json",data:{phone:a,code:h,noverify:1},success:function(a){10001==a.status?window.location.reload():c.$el.find(".js-gerror").html(a.msg)},error:function(){c.$el.find(".js-gerror").html("系统出错，请稍后重试！")},complete:function(){$(".tpl-changePhone .js-submit").text("确定")}})},showAreaCode:function(){$(".js-code-box").toggle(),0==$(".js-code-list li").length&&this.bindAreaCode(0)},setAreaCode:function(c){var a=$(c.target).data("code");$(".js-code-btn span").text(a),$(".js-code-box").hide(),$(".ipt-phone").focus(),$(".js-phoneNumber1").parents(".moco-form-group").find(".moco-control-tip").html(""),"+86"!=a?($(".js-voicecode-send").hide(),$(".js-getCode").css({right:"18px"})):($(".js-voicecode-send").show(),$(".js-getCode").css({right:"112px"}))},clickAreaCode:function(c){var a=$(c.target);a.addClass("curr").siblings().removeClass("curr"),this.bindAreaCode(a.index())},bindAreaCode:function(c){for(var a=AreaCode[c],h="",i=0;i<a.length;i++)h+='<li data-code="'+a[i].code+'">'+a[i].name+"（+"+a[i].code+" ）</li>";$(".js-code-list").html(h),$(".nano").nanoScroller()},render:function(){clearInterval(this.timer),$.dialog(this.tpl,{modal:!0,title:"绑定手机",width:488})},renderFinish:function(){$(".js-modal-close").click(),$.dialog(' <div class="icon-tick-revert s-right"></div><p class="success-hint">恭喜你绑定成功</p><button class="moco-btn moco-btn-blue ">完成[5]</button>',{modal:!0,title:"绑定手机",width:488})}});module.exports=a});