define(function(require){function a(a){var c="";return c+='<div class="yanzheng-id">	                    <div class="keybox"><i class="icon-key"></i></div>				             <p class="font1 mb20">请输入登录密码验证身份<br/>'+a+'</p>	                    <div class="dialogBox yanZhengBox" style="width: 430px;">				            <div class="moco-form-group">				                <label for="inputEmail3" class="moco-control-label">密码：</label>				                <div class="moco-control-input">				                    <input type="password"  placeholder="请输入密码" class="js-pwd moco-form-control" data-validate="require-password">				                    <div class="moco-control-tip errorHint color_red"></div>				                </div>				            </div>				             <div class="moco-form-group">				                <label for="inputEmail3" class="moco-control-label">验证码：</label>				                <div class="moco-control-input w135 mr12">				                    <input data-callback="checkverity"   maxLength=4 placeholder="输入验证码" class="js-verify moco-form-control w140 fl js-phoneCode" data-validate="require-string" data-minLength="4">				                    <div class="moco-control-tip errorHint color_red" data-error-hint="请输入4位验证码"></div>				                </div>				                <div class="yzmBox verify-img-wrap "><img class="verify-img"/><a href="javascript:void(0)" hidefocus="true" class="icon-refresh js-verify-refresh"></a></div>				            </div>				            <div class="moco-form-group">				                <label for="inputEmail3" class="moco-control-label"></label>				                <div class="moco-control-input">				                    <a href="javascript:void(0);" class="moco-btn moco-btn-blue js-sf-submit">确定</a>				                    <a href="javascript:void(0);" class="moco-btn moco-btn-normal js-modal-close">取消</a>				                    <a href="//www.imooc.com/user/newforgot" target="_blank">找回密码</a>				                	<p class="js-gerror tl g_error js-error"></p>				                </div>				            </div>				        </div>            		</div>'}function c(){$(".js-verify-row").show(),$(".verify-img").attr("src","/user/verifycode?t="+(new Date).getTime())}function h(){var a=$(".yanzheng-phone .js-phoneNumber").val();return""==a?($(".yanzheng-phone input").addClass("inpt-error").focus(),void $(".yanzheng-phone .js-error").html("手机号码不能为空")):void(W.validate($(".yanzheng-phone"))&&($(".yanzheng-phone .js-error").html(""),g.errortipshow($(".msg-layer input"),""),$(".yanzheng-phone input").removeClass("inpt-error"),"验证中..."!=$(".yanzheng-phone .js-phone-submit").html()&&($(".yanzheng-phone .js-phone-submit").html("验证中..."),$.ajax({url:"/passport/user/checkphone",data:{phone:a,type:1},dataType:"json",success:function(a){$(".yanzheng-phone .js-phone-submit").html("确定"),10001==a.status?($(".js-modal-close").click(),w||(w=new H({el:"body"})),w.render()):($(".yanzheng-phone input").addClass("inpt-error").focus(),$(".yanzheng-phone .js-error").html(a.msg))},error:function(){$(".yanzheng-phone .js-phone-submit").html("确定"),$(".yanzheng-phone .js-error").html("服务器错误，请稍后重试！")}}))))}function v(a){moco.validateCallback.rel=!1,$.ajax({url:"/user/verifycheck",method:"get",async:!1,data:{verify:a},dataType:"json",success:function(a){0==a.result?(moco.validateCallback.errorHint="",moco.validateCallback.rel=!0):moco.validateCallback.errorHint=a.msg},error:function(){moco.validateCallback.errorHint="网络错误"}})}require("common"),require("./common/common.js");var g=(require("/static/page/user/messagebox.js"),require("/static/page/user/common/settingUitl.js"));require("/static/component/base/util/modal.button.js");var y,b,j,w,k,z,_=require("./settingBindDialogs/setting_phone/setting_phone.js"),C=require("./settingBindDialogs/setting_email/setting_email.js"),B=require("./settingBindDialogs/yanzheng_email/yanzheng_email.js"),D=require("./settingBindDialogs/change_email/change_email.js"),T=require("./settingBindDialogs/setting_password/setting_password.js"),H=require("./settingBindDialogs/change_phone/change_phone.js");$(document).on("click",".js-bindemail",function(){z=new C({el:"body",hasPass:hasPass}),z.render()}),$(document).on("click",".js-changePWD",function(){b||(b=new T({el:"body"})),b.render()}),$.ajaxSetup({cache:!1});var P=function(){function a(){for(var a in o)a.indexOf("/user")>-1&&(o[a].close&&o[a].close(),o[a]=null,delete o[a])}var o={};return{open:function(c){var l,t;return o[c]&&o[c].closed===!1?void(o[c].focus&&o[c].focus()):(a(),l=(screen.width-600)/2,t=(screen.height-400)/2,void(o[c]=window.open(c,"_blank","toolbar=no, directories=no, status=no, menubar=no, width=600, height=500, top="+t+", left="+l)).focus())},clear:a}}();$(document).on("click",".js-bindphone",function(){y||(y=new _({el:"body",mode:"signup",hasPass:hasPass})),y.render()}),$(document).on("focus","input",function(){$(".errorHint , .js-gerror").html("")}),$(document).on("click",".js-verify-refresh",function(){c()}),$(document).on("click",".js-bind",function(e){e.preventDefault(),P.open($(this).attr("href")+"&referer="+window.location.protocol+"//"+window.location.hostname)}),$(document).on("click","[data-unbind]",function(){var a=$(this).attr("data-unbind"),c={qq:"QQ",weibo:"新浪微博",weixin:"微信"}[a],m=$(".msg-layer");m.length||($("body").append('<div class="msg-layer" style="height:300px!important">                <h3>解除绑定</h3>                <p>解绑后将不能再使用'+c+'帐号登录慕课网。</p>                <div class="error js-error"></div>                <input type="password" placeholder="请输入慕课网登录密码" />                <div class="error"></div>                <a href="javascript:void(0)" class="js-sf-submit btn-submit">确定</a>                <a href="//www.imooc.com/user/newforgot" target="_blank" style="float: right;margin-right: 30px;margin-top: 10px;">找回密码</a>                <button aria-hidden="true" hidefocus="true" data-dismiss="modal" class="btn-close" type="button"></button>            </div>'),m=$(".msg-layer"),m.on("shown",function(){function c(){$(".js-error").html(),g.errortiphide($(".msg-layer input"));var c=$(".msg-layer input").val();return 0==c.length?($(".msg-layer input").addClass("inpt-error").focus(),void g.errortipshow($(".msg-layer input"),"请输入慕课网登录密码")):void $.ajax({url:"/passport/user/tpbindcancel",data:{password:c,tp:a},dataType:"json",success:function(a){10001==a.status?window.location.reload():$(".js-error").html(a.msg)},error:function(){$(".js-error").html("服务器错误，请稍后重试！")}})}$(".msg-layer .js-sf-submit").on("click",function(){c()}),$(".msg-layer input").on("keydown",function(a){switch(a.keyCode){case 13:c()}})}).on("hidden",function(){$(this).remove()})),m.modal("show")}),window.__fireLogined=function(){window.location.reload()};var E=$("#jsMail").val(),L=$("#jsPhone").text();$(".js-change-phone").click(function(){var a='<div class="yanzheng-phone">            <div class="keybox">解绑后，您将无法再使用此手机号进行找回密码及登录相关操作。</div>            <div class="dialogBox yanZhengBox" style="width: 430px;">	            <div class="moco-form-group">	                <label for="inputEmail3" class="moco-control-label">已绑定手机号：</label>	                <div class="moco-control-input"><span class="yanzheng-phone-text">'+$("#account").val()+'</span></div>	            </div>	            <div class="moco-form-group">	                <label for="inputEmail3" class="moco-control-label">请输入已绑定手机号：</label>	                <div class="moco-control-input">	                    <input  data-callback="checkPhone"  placeholder="请输入您的手机号" class="moco-form-control js-phoneNumber" id="">	                    <div class="moco-control-tip errorHint color_red"></div>	                </div>	            </div>	            <div class="moco-form-group">	                <label for="inputEmail3" class="moco-control-label"></label>	                <div class="moco-control-input">	                	<a href="javascript:void(0);" class="moco-btn moco-btn-normal js-modal-close">取消</a>	                    <a href="javascript:void(0);" class="moco-btn moco-btn-blue js-phone-submit">下一步</a>	                	<p class="js-gerror tl g_error js-error"></p>	                </div>	            </div>	        </div>		</div>';$.dialog(a,{title:"认证手机号码",modal:!0})}),$(document).on("click",".js-phone-submit",function(){h()}).on("blur",".js-phoneNumber",function(){var a=$(this).val(),r=W.Validater.validateRules["require-mobile-phone"].regex;return r.lastIndex=0,a.length?0==a.indexOf("+")||r.test(a)?void 0:void $(this).next(".moco-control-tip").html("请输入正确手机号"):void $(this).next(".moco-control-tip").html("请输入手机号")}),$(".yanzheng-phone input").on("keydown",function(a){switch(a.keyCode){case 13:h()}}),$(".js-change").click(function(){function h(){if(W.validate($(".yanzheng-id"))&&($(".yanzheng-id .js-error").html(""),g.errortipshow($(".msg-layer input"),""),$(".yanzheng-id input").removeClass("inpt-error"),"验证中..."!=$(".yanzheng-id .js-sf-submit").html())){$(".yanzheng-id .js-sf-submit").html("验证中...");var a=$(".yanzheng-id .js-pwd").val(),h=$(".yanzheng-id .js-verify").val();$.ajax({url:"/user/ajaxcheckpass",data:{passwd:a,verify:h},dataType:"json",success:function(a){$(".yanzheng-id .js-sf-submit").html("确定"),0==a.result?($(".js-modal-close").click(),"email"==y&&(k||(k=new D({el:"body",mall:E})),k.render()),"phone"==y&&(w||(w=new H({el:"body"})),w.render())):(c(),$(".yanzheng-id input").addClass("inpt-error").focus(),$(".yanzheng-id .js-error").html(a.msg))},error:function(){$(".yanzheng-id .js-sf-submit").html("确定"),$(".yanzheng-id .js-error").html("服务器错误，请稍后重试！")}})}}var v,y=$(this).attr("changeType");v=a("email"==y?E:L),$.dialog(v,{title:"验证身份",modal:!0}),c(),$(".verify-img").attr("src","/user/verifycode?t="+(new Date).getTime()),$(document).on("click",".js-sf-submit",function(){h()}),$(".yanzheng-id input").on("keydown",function(a){switch(a.keyCode){case 13:h()}})}),moco.validateCallback.checkverity=function(a){v(a)},$(".js-verify").click(function(){var a=$(this);"正在发送..."!=a.text()&&(a.text("正在发送..."),$.ajax({url:"/user/verificationmail",dataType:"json",success:function(c){0==c.status?(j||(j=new B({el:"body",mall:E})),j.render(),a.text("立即验证")):($.alert("error",{info:c.msg}),a.text("立即验证"))},error:function(){$.alert("error",{info:"系统错误！"}),a.text("立即验证")}}))})});