!function(a){function h(h,c){this.fieldState={},this.rules={},this.$form=a(c),this.init(h)}a.extend(h.prototype,{options:{defaultBlur:function(e){a(this).validate(e)},defaultKeyup:function(e){a(this).validate(e)},defaultFocus:function(){}},defaultRules:{email:function(a,h){if(-1!=h.indexOf("@")){var r=/^[a-zA-Z0-9]+([._\-]*[a-zA-Z0-9]+)*@([a-zA-Z0-9]+([._\-][a-zA-Z0-9]+))+$/;if(!h.length)return"手机号/邮箱不能为空！";if(!r.test(h))return"邮箱格式不正确！"}else{var r=/^(13[0-9]|14[56789]|15[012356789]|16[6]|17[0-9]|18[0-9]|19[89])[0-9]{8}$/g;if(!h.length)return"手机号/邮箱不能为空！";if(0!=h.indexOf("+")&&!r.test(h))return"手机号格式不正确！"}},password:function(a,h){var r=/^[\w~`!@#$%&*.()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return h.length?r.test(h)?void 0:"请输入6-16位密码，区分大小写，不能使用空格！":"密码不能为空！"},nick:function(a,h){var r=/^[\w\u4E00-\u9FA5]{2,18}$/;return h.length?r.test(h)?void 0:"昵称2-18位中英文、数字及下划线！":"昵称不能为空！"},equalTo:{rule:function(h,c){var v=a(this.form).find("[name='"+c+"']").val();return v=a.trim(v),h!==v?"两次密码输入不一致！":void 0},force:1}},init:function(h){var c,v,i,g,_,$,y,S,b=h.fields,F=this,k={error:1,valid:1,before:1,after:1};for(c in k)h["on"+c]&&(this.on("vd."+c,h["on"+c]),delete h["on"+c]);this.$form.find("[data-validate]").length;this.$form.find("[data-validate]").each(function(){var h=a(this),n=a(this).attr("name");n&&(F.rules[n]=(F.rules[n]||(F.rules[n]=[])).concat(h.attr("data-validate").split("|")))});for(c in b)(v=b[c].rules)&&(this.rules[c]=(this.rules[c]||(this.rules[c]=[])).concat(v));for(c in this.rules){for(v=this.rules[c],y=0,i=0,g=v.length;g>i;i++)_=v[i],"string"==typeof _&&v.splice(i,1,this.defaultRules[_]),y=v[i].force;y&&(v.force=1),S=b[c]||{},$={blur:S.blur||this.options.defaultBlur,keyup:S.keyup||this.options.defaultKeyup,focus:S.focus||this.options.defaultFocus};for(i in k)S["on"+i]&&($["vd."+i]=S["on"+i]);this.$form.find("[name='"+c+"']").on($),this.fieldState[c]=0}delete h.fields},valid:function(h,c){{var v=a(h).attr("name");a(h).val()}0===this.fieldState[v]&&c&&"keyup"==c.type||this._valid(h,c)},_valid:function(a,h){if(a)this.check(a,h);else for(var c in this.rules)this.check(c,0)},check:function(h,c){function v(){var r,a;S=y[F++],a=S.rule||S,"function"==typeof a&&(r=a.call($[0],g,b),"object"==typeof r?y.xhr=r:"pending"!==r&&g(r))}function g(h){void 0!==h&&h!==!0?(E.fieldState[_]=!1,$.trigger(a.Event("vd.error",{_relateField:$[0],tip:h||S.tip||""})),$.trigger(a.Event("vd.after",{_relateField:$[0]}))):F===k?(E.fieldState[_]=!0,$.trigger(a.Event("vd.valid",{_relateField:$[0]})),$.trigger(a.Event("vd.after",{_relateField:$[0]}))):v()}var _,$,y,S,b,F,k,E;if("string"==typeof h?(_=h,$=this.$form.find("[name='"+h+"']")):($=a(h),_=$.attr("name")),_){if(b=$.val(),y=this.rules[_],y._value===b&&!c&&!y.force)return this.fieldState[_];$.trigger(a.Event("vd.before",{_relateField:$[0]})),this.fieldState[_]="pending",y._value=b,y.xhr&&(y.xhr.abort(),delete y.xhr),F=0,k=y.length,E=this,v()}},getFullState:function(){var a,h=!0;for(a in this.fieldState)if(this.fieldState[a]!==!0&&(h=this.fieldState[a],h===!1))break;return h},validate:function(h){var c;if(this._valid(),c=this.getFullState(),"pending"===c){if(!this.binded){this.binded=1,this.onerror=[],this.onsuccess=[];var v=a.proxy(function(){this.fire("error")},this);this.one("vd.error.form",v),this.one("vd.before.errror",v),this.on("vd.valid.success",a.proxy(function(){this.getFullState()===!0&&this.fire("success")},this))}this.onerror.push(h.error),this.onsuccess.push(h.success),delete h.error,delete h.success}else c===!0?h.success.call(this.$form[0],this.getValues()):h.error.call(this.$form[0],this.getValues())},fire:function(f){var a,h,c=this["on"+f],i=0;if(c){for(a=c.length,h=this.getValues();a>i;i++)c[i].call(this.$form[0],h);this.clean()}},clean:function(){this.binded=0,this.onerror=this.onsuccess=null,this.off("vd.before.errror"),this.off("vd.form.success"),this.off("vd.error.form")},getValues:function(){var a,o={};for(a in this.rules)o[a]=this.rules[a]._value;return o}}),a.each("on,off,trigger,one".split(","),function(i,a){h.prototype[a]=function(){this.$form[a].apply(this.$form,arguments)}}),a.fn.validate=function(h){var c,v=this[0],g=v.tagName.toLowerCase();"form"!=g?(c=a(v.form).data("_validater"),c&&c.valid(v,h)):(c=a(this).eq(0).data("_validater"))&&c.validate(h)},a.fn.validateSetup=function(c){return a(this).each(function(){a(this).data("_validater")||a(this).data("_validater",new h(c,this))}),this}}($);