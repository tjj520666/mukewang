<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

	<head>
		<link rel="shortcut icon" href="/houtai/img/favicon.ico" >
		<meta charset="UTF-8">
		<title>视频管理</title>
		<link rel="stylesheet" href="/houtai/css/bootstrap.css" />
	</head>

	<body style="background-color: #e6ecf5;">
		<!-- 视频新增模态框 -->
		<div class="modal fade" id="videoAddModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="addModalLabel">视频信息新增</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" id="submitForm">
							<div class="form-group">
								<label for="inputName" class="col-sm-2 control-label">名称</label>
								<div class="col-sm-6">
									<input type="Name" class="form-control" name="mvName" id="inputName" placeholder="Title">
								</div>
							</div>
							<div class="form-group">
								<label for="inputTitle" class="col-sm-2 control-label">标题</label>
								<div class="col-sm-6">
									<input type="Title" class="form-control" name="mvTitle" id="inputTitle" placeholder="Title">
								</div>
							</div>
							<div class="form-group">
								<label for="inputParticulars" class="col-sm-2 control-label">详情</label>
								<div class="col-sm-6">
									<input type="Particulars" class="form-control"  name="mvDetails " id="inputParticulars" placeholder="Particulars">
								</div>
							</div>

							<div class="form-group">
								<label for="inputPrice" class="col-sm-2 control-label">价格</label>
								<div class="col-sm-6">
									<input type="Price" class="form-control" name="mvPrice" id="inputPrice" placeholder="Price">
								</div>
							</div>
							<div class="form-group">
								<label for="updateName" class="col-sm-2 control-label">分类</label>
								<div class="form-group col-md-4 " id="spu-select-firstCategory">
									<!-- 一级select -->
									<select  class="form-control selectpicker show-tick reset" name="mvType1id" id="aselect-first">
										<option value="">请选择</option>
									</select>
								</div>

								<!-- 二级select -->
								<div class="form-group col-md-3" id="box-select-two" >
									<select   class="form-control selectpicker show-tick reset"  name="mvType2id" id="aselect-two" >

									</select>
								</div>

								<!-- 三级select -->
								<div class="form-group col-md-3" id="box-select-three" >
									<select   class="form-control selectpicker show-tick reset" name="mvType3id" id="aselect-three" >

									</select>
								</div>
							</div>


							<div class="form-group">
								<label for="updateScope" class="col-sm-2 control-label">是否免费</label>
								<div class="col-sm-6">
									<select   class="form-control selectpicker show-tick reset" name="mvRs" id="addRs" >
										<option value="0">免费</option>
										<option value="1">付费</option>
									</select>
								</div>
							</div>


							<div class="form-group">
								<label for="inputmvDifficultyid" class="col-sm-2 control-label">难度</label>
								<div class="col-sm-6">
									<input type="Difficultyid" class="form-control" name="mvDifficultyid" id="inputmvDifficultyid" placeholder="Difficultyid">
								</div>
							</div>



							<div class="form-group">
								<label for="inputmvScope" class="col-sm-2 control-label">评分</label>
								<div class="col-sm-6">
									<input type="Difficultyid" class="form-control" name="mvScope" id="inputmvScope" placeholder="Difficultyid">
								</div>
							</div>

							<div class="form-group">
								<label for="inputDuration" class="col-sm-2 control-label">时长</label>
								<div class="col-sm-6">
									<input type="Duration" class="form-control" name="mvDuration" id="inputDuration" placeholder="Time">
								</div>
							</div>
							
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn addbtn-primary">保存</button>
					</div>
				</div>
			</div>
		</div>




		<!--视频新增模态框-->
		<div class="modal fade" id="FileInfoModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">视频新增</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" id="FileSubmit" th:action="@{FileInfo}" method="post" enctype="multipart/form-data">
							<div class="form-group">
								<label for="inputName" class="col-sm-2 control-label">章节</label>
								<div class="col-sm-6">
									<select   class="form-control selectpicker show-tick reset" name="mvinfoSection" id="addmvinfoSection" >

									</select>
								</div>
							</div>


							<div class="form-group">
								<label for="inputName" class="col-sm-2 control-label">名称</label>
								<div class="col-sm-6">
									<input type="Name" class="form-control" name="mvinfoName" >
								</div>
							</div>
							<div class="form-group">
								<label for="inputTitle" class="col-sm-2 control-label">时长</label>
								<div class="col-sm-6">
									<input type="Title" class="form-control" name="mvinfoTime" >
								</div>
							</div>
							<div class="form-group">
								<label for="inputFiles" class="col-sm-2 control-label">文件</label>
								<div class="col-sm-6">
									<input type="File" class="form-control" name="file" >
								</div>
							</div>
							<div class="form-group">
								<label for="inputParticulars" class="col-sm-2 control-label">简介</label>
								<div class="col-sm-6">
									<input type="Particulars" class="form-control"  name="mvinfoInfo"  >
								</div>
							</div>


						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-primary1">保存</button>
					</div>
				</div>
			</div>
		</div>



		<!--章节新增模态框-->
		<div class="modal fade" id="sectionInfoModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">章节新增</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" id="sectionSubmit">
							<div class="form-group">
								<div class="col-sm-6">
									<input type="hidden" class="form-control" name="sectionMv"  id="sectionMv">
								</div>
							</div>
							<div class="form-group">
								<label for="inputName" class="col-sm-2 control-label">标题</label>
								<div class="col-sm-6">
									<input type="Name" class="form-control" name="sectionTitle" >
								</div>
							</div>
							<div class="form-group">
								<label for="inputParticulars" class="col-sm-2 control-label">简介</label>
								<div class="col-sm-6">
									<input type="Particulars" class="form-control"  name="sectionIntro"  >
								</div>
							</div>
							<div class="form-group">
								<label for="updateState" class="col-sm-2 control-label">状态</label>
								<div class="col-sm-3">
									<select class="form-control" name="sectionOnsale" id="updateState">
										<option value="0">未上架</option>
										<option value="1">上架</option>
									</select>
								</div>
							</div>


						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn sectionaddbtn-primary">保存</button>
					</div>
				</div>
			</div>
		</div>



		<!-- 视频修改模态框 -->
		<div class="modal fade" id="videoUpdateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="updateModalLabel">视频修改</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" id="updateMv">
							<div class="form-group">
								<div class="col-sm-6">
									<input type="hidden" class="form-control" name="mvId" id="updatemvId" >
								</div>
							</div>
							<div class="form-group">
								<label for="updateName" class="col-sm-2 control-label">名称</label>
								<div class="col-sm-6">
									<input type="Name" class="form-control" name="mvName" id="updateName" placeholder="Name">
								</div>
							</div>


							<div class="form-group">
								<label for="updateTitle" class="col-sm-2 control-label">标题</label>
								<div class="col-sm-6">
									<input type="Title" class="form-control" name="mvTitle" id="updateTitle" placeholder="Title">
								</div>
							</div>
							<div class="form-group">
								<label for="updateParticulars" class="col-sm-2 control-label">详情</label>
								<div class="col-sm-6">
									<textarea type="Particulars" class="form-control"  name="mvDetails " id="updateParticulars" placeholder="Particulars"></textarea>
								</div>
							</div>
							<div class="form-group">
								<label for="updatePrice" class="col-sm-2 control-label">价格</label>
								<div class="col-sm-6">
									<input type="Price" class="form-control" name="mvPrice" id="updatePrice" placeholder="Price">
								</div>
							</div>

							<div class="form-group">
								<label for="updateName" class="col-sm-2 control-label">分类</label>
							<div class="form-group col-md-4 " id="updatespu-select-firstCategory">
								<!-- 一级select -->
								<select  class="form-control selectpicker show-tick reset" name="mvType1id" id="uselect-first">
									<option value="">请选择</option>
								</select>
							</div>

							<!-- 二级select -->
							<div class="form-group col-md-3" id="updatebox-select-two" >
								<select   class="form-control selectpicker show-tick reset" name="mvType2id" id="uselect-two" >

								</select>
							</div>

							<!-- 三级select -->
							<div class="form-group col-md-3" id="updatebox-select-three" >
								<select   class="form-control selectpicker show-tick reset" name="mvType3id" id="uselect-three" >

								</select>
							</div>
							</div>


							<div class="form-group">
								<label for="updateScope" class="col-sm-2 control-label">是否免费</label>
								<div class="col-sm-6">
									<select   class="form-control selectpicker show-tick reset" name="mvRs" id="updateRs" >
											<option value="0">免费</option>
											<option value="1">付费</option>
									</select>
								</div>
							</div>


							<div class="form-group">
								<label for="updateScope" class="col-sm-2 control-label">评分</label>
								<div class="col-sm-6">
									<input type="type" class="form-control"  name="mvScope" id="updateScope" placeholder="type">
								</div>
							</div>
							<div class="form-group">
								<label for="updateDuration" class="col-sm-2 control-label">时长</label>
								<div class="col-sm-6">
									<input type="Duration" class="form-control" name="mvDuration" id="updateDuration" placeholder="Time">
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" class="btn updatebtn-primary">更新</button>
					</div>
				</div>
			</div>
		</div>

		<div class="operation" style="margin: 10px 0px">
			<div style="margin-left:870px;">
			<button class="btn btn-info" id="video_add_modal_btn" >
				<span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
				新增</button>

			<button class="btn btn-danger" id="video_delete_all_btn">
				<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
				删除选中</button>
			</div>
		</div>
		<div class="user">
			<table class="table table-striped" id="user_table">
				<thead>
					<tr>
						<th><input type="checkbox" id="check_all" /></th>
						<th>#</th>
						<th>标题</th>
						<th>时长</th>
						<th>价格</th>
						<th>类别</th>
						<th>付费</th>
						<th>操作</th>
					</tr>
					<tr th:each="video:${video.list}">
						<th><input type="checkbox" class="check_item" /></th>
						<th th:text="${video.mvId}"></th>
						<th th:text="${video.mvName}"></th>
						<th th:text="${video.mvDuration}"></th>
						<th th:text="${video.mvPrice}"></th>
						<th th:text="${video.mvType1id}"></th>
						<th th:text="${video.mvRs==1?'是':'否'}"></th>
						<th>
							<button class="btn btn-primary" id="video_update_modal_btn" th:value="${video.mvId}">
								<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
								编辑
							</button>
							<button class="btn btn-danger" id="video_del_modal_btn" th:value="${video.mvId}">
								<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
								删除
							</button>
							<button class="btn btn-success" id="video_add_modal_btn2"  th:value="${video.mvId}">
								<span class="glyphicon glyphicon-plus-sign" aria-hidden="true" ></span>
								章节新增</button>

							<button class="btn btn-warning" id="video_add_modal_btn3"  th:value="${video.mvId}">
								<span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
								视频新增</button>
						</th>
					</tr>

					
				</thead>
			</table>
		</div>
		
		<div class="row">
			<div class="col-md-5 col-md-offset-1">
				当前第 <strong th:text="${video.pageNum}"></strong> 页,
				总共 <strong th:text="${video.pages}"></strong> 页,
				总共 <strong th:text="${video.total}"></strong> 条数据;
			</div>
			<div class="col-md-6">
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li>
							<a th:href="@{/getVideo(pn=1)}" aria-label="Previous" >
								<span aria-hidden="true">首页</span>
							</a>
						</li>

						<li >
							<a th:if="${video.hasPreviousPage}" th:href="@{/getVideo(pn=${video.pageNum-1})}" aria-label="Previous" >
								<span aria-hidden="true">&laquo;</span>
							</a>
						</li>
						<li th:each="pns:${video.navigatepageNums}" th:class="${pns==video.getPageNum()?'active':''}">
							<a th:href="@{/getVideo(pn=${pns})}" th:text="${pns}"></a>
						</li>

						<li>
							<a th:if="${video.hasNextPage}" th:href="@{/getVideo(pn=${video.pageNum+1})}" aria-label="Next">
								<span aria-hidden="true">&raquo;</span>
							</a>
						</li>
						<li>

							<a th:href="@{/getVideo(pn=${video.pages})}" aria-label="Previous" >
								<span aria-hidden="true" disabled="disabled">末页</span>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
		
	</body>
	<script type="text/javascript" src="/houtai/js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="/houtai/js/bootstrap.js"></script>
	<script type="text/javascript"></script>
	<script>
		$(function() {
            function  sel1(){
                //一级菜单
                $.post("selectParents",{"parentId":0},function (data) {
                    $("#aselect-first").html("");
                    for(var i=0;data.length;i++){
                        $("#aselect-first").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                    }
                })


                //二级菜单
                $("#aselect-first").change(function () {
                    $.post("selectParents",{"parentId":$(this).val()},function (data) {
                        $("#aselect-two").html("");
                        $("#aselect-three").html("");
                        $("#aselect-two").append("<option value=''>"+'请选择'+"</option>");
                        $("#aselect-three").append("<option value=''>"+'请选择'+"</option>");
                        for(var i=0;data.length;i++){
                            $("#aselect-two").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                        }
                    })
                })


                //三级菜单
                $("#aselect-two").change(function () {
                    $.post("selectParents",{"parentId":$(this).val()},function (data) {
                        $("#aselect-three").html("");
                        $("#aselect-three").append("<option value=''>"+'请选择'+"</option>");
                        for(var i=0;data.length;i++){
                            $("#aselect-three").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                        }
                    })
                })
            }



		    function  sel(){
                //一级菜单
                $.post("selectParents",{"parentId":0},function (data) {
                    $("#uselect-first").html("");
                    for(var i=0;data.length;i++){
                        $("#uselect-first").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                    }
                })


                //二级菜单
                $("#uselect-first").change(function () {
                    $.post("selectParents",{"parentId":$(this).val()},function (data) {
                        $("#uselect-two").html("");
                        $("#uselect-three").html("");
                        $("#uselect-two").append("<option value=''>"+'请选择'+"</option>");
                        $("#uselect-three").append("<option value=''>"+'请选择'+"</option>");
                        for(var i=0;data.length;i++){
                            $("#uselect-two").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                        }
                    })
                })


                //三级菜单
                $("#uselect-two").change(function () {
                    $.post("selectParents",{"parentId":$(this).val()},function (data) {
                        $("#uselect-three").html("");
                        $("#uselect-three").append("<option value=''>"+'请选择'+"</option>");
                        for(var i=0;data.length;i++){
                            $("#uselect-three").append("<option value='"+data[i].categoryId+"'>"+data[i].categoryTitle+"</option>");
                        }
                    })
                })
			}







			//点击新增按钮弹出新增模态框
			$("#video_add_modal_btn").click(function() {
				$("#videoAddModal").modal({
					backdrop: "static"
				});
				sel1();
			});

            //章节新增
            $(".btn-success").click(function() {
                $("#sectionInfoModel").modal({
                    backdrop: "static"
                });
                var id=$(this).val();
                $("#sectionMv").val(id);

            });


			//视频新增
            $(".btn-warning").click(function() {
                $("#FileInfoModel").modal({
                    backdrop: "static"
                });
                var id=$(this).val();
                $.post("selectAllSection",{"id":id},function (data) {
                    $("#addmvinfoSection").html("");
                    for(var i=0;data.length;i++){
                        $("#addmvinfoSection").append("<option value='"+data[i].sectionId+"'>"+data[i].sectionTitle+"</option>");
                    }
                })

            });





			//点击编辑按钮弹出修改模态框
			$(".btn-primary").click(function() {
				$("#videoUpdateModal").modal({
					backdrop: "static"
				});
                sel();



                var id=$(this).attr("value");
                $.post("getVideoById",{"id":id},function (data) {
                    $("#updateTitle").val(data.mvTitle);
                    $("#updateParticulars").val(data.mvDetails);
                    $("#updateDuration").val(data.mvDuration);
                    $("#updatePrice").val(data.mvPrice);
					$("#updatespu-select-firstCategory select").val([data.mvType1id]);
					$("#updatebox-select-two  select").val([data.mvType2id]);
					$("#updatebox-select-three select").val([data.mvType3id]);
					$("#updateRs").val([data.mvRs]);
                    $("#updateScope").val(data.mvScope);
                    $("#updateName").val(data.mvName);
                    $("#updatemvId").val(data.mvId);
                });

			});
            //修改视频信息
            $(".updatebtn-primary").click(function () {
                mv=$("#updateMv").serialize();
               	var url="[[@{/getVideo(pn)}]]=";
                $.post("updateMv",mv,function (data) {
                    if (data!=null){
                        window.location.href=url+[[${video.getPageNum()}]];
                        $("#videoUpdateModal").modal('hide');
                        alert("更新成功!");
                    }
                })
            })



            //点击全选
            $("#check_all").click(function () {
                $(".check_item").prop("checked",$(this).prop("checked"));
            });

            //都选中后选中全选按钮
            $(document).on("click",".check_item",function () {
                var flag = $(".check_item:checked").length==$(".check_item").length;
                $("#check_all").prop("checked",flag);

            });


            //点击删除
            $(".btn-danger").click(function() {
				var url=url="[[@{/getVideo(pn)}]]=";
                var ids=$(this).attr("value");
					if(ids!=""&&ids!=null){
                        if (confirm("确定要删除该视频吗?")){
                            $.post("delMv",{"ids":ids},function (data) {
                                if (data!=""&&data!=null){
                                    window.location.href=url;
                                    alert("删除成功");
                                }
                            });
                        }
					}

            });

            var videoId ="";
            //删除选中的信息
            $("#video_delete_all_btn").click(function () {

                var url=url="[[@{/getVideo(pn)}]]=";
                $.each($(".check_item:checked"),function(){
                    videoId += $(this).parents("tr").find("th:eq(1)").text()+"-";
                });
                videoId = videoId.substring(0,videoId.length-1);
				if(videoId!=""&&videoId!=null){
                    if (confirm("确认删除吗?")) {
                        $.post("delMv",{"ids":videoId}, function (data) {
                            if (data!=null&&data!=""){
                                window.location.href=url;
                                alert("删除成功!");
							}
                        });

                    }
				}else{
                    alert("请先选择再进行此操作!");
				}

            });
            //点击新增按钮
            $(".addbtn-primary").click(function () {
                var Mv= $("#submitForm").serialize();
               	var url="[[@{/getVideo(pn)}]]=";
                $.post("addVideo",Mv,function (data) {
                    if(data=="1"){
                        alert("添加成功!");
                        window.location.href=url+[[${video.pages}+1]];
                        $("#videoAddModal").modal('hide');
                    }
                });
            });


            //章节新增
            $(".sectionaddbtn-primary").click(function () {
                var section= $("#sectionSubmit").serialize();
                $.post("addSection",section,function (data) {
                    if(data=="1"){
                        alert("添加成功!");
                        $("#sectionInfoModel").modal('hide');
                    }
                });
            });


		});


		$(".btn-primary1").click(function () {
			$("#FileSubmit").submit();
        })


	</script>

</html>
